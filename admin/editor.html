<!doctype html>
<html lang="no">
  <head>
    <meta charset="utf-8" />
    <title>Macé Cafe — Editor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      /* Mobile-friendly base for the embedded CMS UI */
      html,body{height:100%}
      body{ margin:0; background:#fafafa; color:#111; font:16px/1.5 Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif }
      /* Make form controls comfy on small screens */
      @media (max-width: 900px){
        /* CMS containers vary; these safe rules keep controls usable */
        input, select, textarea { font-size:16px; } /* prevents iOS zoom */
        .nc-appHeader{ position:sticky; top:0; z-index:5; }
        /* let the main area use full width */
        #nc-root, .css-1, .nc-root { padding:0 !important; }
      }
    </style>
    <!-- Identity present so CMS can auth via Git Gateway -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <!-- Netlify CMS -->
    <script src="https://unpkg.com/netlify-cms-app/dist/netlify-cms.js"></script>
    <script>
      // Deep-link to a collection or file-entry via query param
      (function(){
        const p = new URLSearchParams(location.search);
        const col = p.get('collection');
        /* Map file collections to their single entry slugs (adjust if your config.yml uses different 'name:' fields) */
        const entryByCol = { dagens:'dagens', aapningstider:'hours', meny:'meny', forside:'home' };
        if (col) {
          const entry = entryByCol[col];
          if (entry) location.hash = '#/collections/' + col + '/entries/' + entry;
          else location.hash = '#/collections/' + col;
        }
      })();

      // Ensure user is logged in (if not, open the login modal)
      document.addEventListener('DOMContentLoaded', () => {
        if (window.netlifyIdentity) {
          window.netlifyIdentity.on('init', (user) => {
            if (!user) { window.netlifyIdentity.open('login'); }
          });
          try { window.netlifyIdentity.init({}); } catch(e){}
        }
      });
    </script>
  </head>
  <body></body>
</html>
